# 1주차 (~21.08.15)

## JVM이란 무엇일까요?

**JVM** 은 **Java Virtual Machine**, **자바 가상 머신**입니다.

<u>자바 코드를 구동하는 엔진</u>을 말합니다.

다른 프로그래밍 언어들의 컴파일러는 대부분 특정 시스템에 종속적인 코드를 생성합니다. 하지만, **Java 컴파일러는 Java 가상 머신, 즉 JVM에 대한 Bytecode를 생성**합니다.

<br/>

우리가 <u>Java 프로그램을 컴파일할 때 Bytecode가 생성</u>됩니다. 

**Bytecode**는 <u>어느 플랫폼(OS) 이나 사용 가능한 소스 코드</u>입니다.

Bytecode는 자바 소스와 호스트 시스템의 중간 언어입니다. 즉 기계어와 고급 언어의 사이에 위치하는 언어입니다.

**Java 컴파일러가 JVM이 해석할 수 있는 Bytecode 를 생성**하면 **JVM은 각 플랫폼/OS에 알맞게 Bytecode를 해석**합니다.

<br/>

이러한 특징은 Java를 **플랫폼/OS에 독립적인 언어**로 만들어주는 매커니즘입니다.

하지만 <u>JVM은 플랫폼/OS에 종속적</u>이 되겠습니다. 각 플랫폼/OS에 알맞게 JVM을 설치해야하기 때문입니다.

알맞은 JVM을 설치하면 **JVM은 플랫폼에 맞게 기계어를 생성**합니다. 

**자바 컴파일러**는 JVM에서 해석할 수 있는 Bytecode로만 바꾸면 되므로 **플랫폼에 독립적**인 것입니다.

<br/>

Java 컴파일러는 Java 코드를 컴파일해서 Bytecode를 생성하고, JVM은 Bytecode를 인터프리팅해서 기계어로 만들기 때문에 **Java는 `compile and interpreter` 언어**라고도 불립니다.

<br/>

## 컴파일 방법

terminal(cmd)에서 Java 코드를 작성하고 해당 코드가 있는 디렉터리로 이동합니다.

해당 위치에서 컴파일을 하려면 **`javac` 라는 키워드**를 붙여서 명령어를 입력합니다.

*(예시 `javac Example.java`)*

<br/>

그러면 해당 경로에 **`Example.class`** 라는 클래스 파일이 생성됩니다.

`class` 파일의 형태는 JVM에서 해석할 수 있는 Bytecode가 들어있습니다.

이 파일을 바로 OS에서 실행할 수는 없습니다.

<br/>

## 실행하는 방법

Bytecode인 `class` 파일을 OS에서 실행하려면 다시 명령어를 입력해야 합니다.

이 때는 **`java` 키워드**를 사용합니다.

`java` 키워드로 Bytecode가 존재하는 class 파일 이름을 입력합니다.

*(예시 `java Example`)*

<br/>

명령어를 입력한다면 해당 클래스 안에 `main` 메소드가 실행되면서 코드 실행이 가능합니다.

<br/>



## 바이트코드란?

**Bytecode**는 **자바 가상 머신(JVM)이 실행하는 명령어의 형태**입니다.

자세하게 말하자면 `javac` 명령어를 통해 컴파일러가 JVM이 이해할 수 있는 언어로 변환한 `class` 파일을 의미합니다.

`class` 파일은 0과 1로만 구성되어 있으며 JVM이 설치되어 있다면 `class` 파일의 바이트 코드는 OS와 상관 없이 실행될 수 있습니다.

<br/>

**📌 그렇다면 IDE를 통해 `java` 파일을 만들어 저장한다면 내부적으로 어떤 동작이 일어날까요?**

1. SSD에 Java 소스 코드가 저장됩니다.

2. 플랫폼은 램에 `JDK\bin` 에 위치한 컴파일러를 올립니다.

3. 램에 위치한 컴파일러는 SSD에 저장된 Java 소스 코드를 찾습니다.

4. 컴파일러는 찾은 Java 파일을 CPU의  레지스터에 정보를 보냅니다.

   *이 때, 레지스터의 저장공간은 작기 때문에 정보를 한번에 보내지 않고 조금씩 보냅니다.* 

5. 레지스터는 컴파일러가 보낸 자바 파일의 정보를 CPU와 주고받습니다.

6. 레지스터는 CPU와 주고받은 정보를 다시 컴파일러에게 보냅니다.
7. 4~6 을 반복하면서 레지스터가 모든 Java 파일의 정보를 CPU와 주고받는다면 컴파일러가 SSD 내부에 Bytecode로 구성된 `class` 파일을 생성합니다.

<br/>

자바 프로그래머가 자바 바이트코드를 반드시 인지할 필요는 없습니다.

단지, <u>컴파일러가 자바 코드를 컴파일하면 Bytecode를 생성하고 그 Bytecode는 JVM으로 인해 해석되어 기계어로 변환된다</u>는 과정을 잘 이해하고 있으면 됩니다.

<br/>

## JIT 컴파일러란?

**JIT**는 **Just-In-Time**의 약자입니다. 직역하자면 제 시간 안에, 실시간의 라는 뜻이라고 생각됩니다.

**JIT 컴파일러**는 **프로그램을 실제 실행하는 시점에(실행과 동시에, 실시간으로) 기계어로 번역하는 컴파일 기법**입니다.

<br/>

흔히 알고있는 코드를 해석하는 방법은 인터프리트 방식과 컴파일 방식입니다.

인터프리트 방식은 프로그래밍 언어를 한 줄씩 읽어가면서 해당 기능에 대응하는 기계어 코드를 실행합니다.

반면 정적 컴파일 방식은 실행 전에 프로그램 코드를 기계어로 모두 번역하는 것을 뜻합니다.

JIT 컴파일러는 두 가지의 방식을 혼합한 방식으로 **실행 시점에서 인터프리트 방식으로 기계어 코드를 생성하면서 그 코드를 기억하고 있어, 같은 메소드가 여러 번 호출될 때 매번 기계어 코드를 생성하지 않고 전에 해석한 코드를 재사용**합니다.

<br/>

<u>JVM은 JIT 컴파일을 지원</u>하며 이 JIT 컴파일러는 <u>JRE 안에 존재</u>합니다.

자바 컴파일러가 자바 코드를 바이트코드로 변환한 후 **실제 바이트코드를 실행하는 시점에서 JVM이 JIT 컴파일러를 사용해 기계어로 변환**합니다.

<br/>

## JDK 구성요소

![image](https://user-images.githubusercontent.com/49138331/129469869-048639dd-a49a-4de4-aabd-ef12ad1230ca.png)

<br/>

- Class Loader
  - 컴파일된 `class` 파일을 JVM으로 로드합니다.
  - 모든 `class` 파일을 한 번에 메모리에 올리는게 아니라 필요할 때마다 동적으로 올려줍니다.
  - loading (`class` 읽기) - linking (reference 연결) - initialize 단계로 동작합니다.
- Method Area
  - Class의 field, method, type, constant pool, static, final 이 관리됩니다.
- Heap
  - 모든 객체가 저장되는 공간입니다.
  - 인스턴스 변수, 배열과 같은 정보들을 저장합니다.
  - `Method Area` 에 올라간 `Class` 의 객체만 생성 가능하고 사용되지 않는 값은 GC가 제거합니다.
- JVM Language Stacks
  - 지역 변수들을 저장하고 스레드를 관리합니다.
  - 스레드 블록이 쌓이고, 프로세스가 끝나면 삭제됩니다.
- PC Registers
  - 현재 실행 중인 메소드의 주소를 저장하고, 문맥 전환(context switch) 가 발생될 때 사용됩니다.
- Native Method Stacks
  - 자바가 아닌 다른 언어로 작성된 코드를 실행할 때 사용합니다.
  - Native library 지침을 따르고 있는 고ㅇ간입니다.
- Execution Engine
  - 로드된 바이트 코드를 실행하는 엔진입니다.
  - 바이트 코드를 명령어 단위로 읽는데, JIT 컴파일러가 중복되는 부분은 따로 저장해놓고 중복 부분이 나오면 미리 저장해놓은 값을 실행합니다. 그 외에는 인터프리터 방식을 사용합니다.
  - GC도 이 영역에 해당합니다.

<br/>

## JDK와 JRE

| JDK                                                          | JRE                                                          |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 자바 개발 도구<br />(Java Development Kit)                   | 자바 실행 환경<br />(Java Runtime Environment)               |
| JRE + 개발을 위해 필요한 도구 (`javac`, `java`) 등을 포함    | 자바 프로그램을 동작시킬 때 필요한 라이브러리 파일들과 기타 파일을 포함 |
| 자바 구현/실행 전용. 읽기/쓰기 전용                          | 자바 실행 전용. 읽기 전용                                    |
| ![image](https://user-images.githubusercontent.com/49138331/129470079-03601691-f22b-4d09-91bd-542e596015f1.png) | ![image](https://user-images.githubusercontent.com/49138331/129470075-84f9d862-e4de-4636-b68e-e2f0ddd50139.png) |



